# User and Credits Test
# Tests the 'user' MCP tool - checking user info and remaining credits
# Safe test: Does not consume credits or modify data

criteria:
  success_rate: 1

providers:
  - name: azure-openai-gpt41
    type: AZURE
    auth_type: entra_id
    model: gpt-4.1
    baseUrl: "{{AZURE_OPENAI_ENDPOINT}}"
    version: 2025-01-01-preview

servers:
  - name: heygen-mcp
    type: stdio
    command: "{{SERVER_COMMAND}}"
    server_delay: 10s
    env:
      HEYGEN_API_KEY: "{{HEYGEN_API_KEY}}"

agents:
  - name: gpt41-agent
    servers:
      - name: heygen-mcp
    provider: azure-openai-gpt41

settings:
  verbose: true
  max_iterations: 10

sessions:
  - name: "User Account Information"
    tests:
      - name: "Get user info"
        prompt: |
          Get my HeyGen user profile information.
          Report my username and email address.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: user
          - type: output_regex
            pattern: "(?i)(username|email|@)"

      - name: "Check remaining credits"
        prompt: |
          Check how many API credits I have remaining in my HeyGen account.
          Report the exact number of remaining credits.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: user
          - type: output_regex
            pattern: "(?i)(credits?|remaining)"
